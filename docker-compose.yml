version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: dazno_web_1
      APP_PORT: 3000

  web:
    build: .
    restart: on-failure
    environment:
      # API externe pour recommandations seulement
      - MCP_API_URL=https://api.dazno.de
      
      # Connexions locales Umbrel
      - LND_HOST=umbrel.local
      - LND_GRPC_PORT=10009
      - LND_REST_PORT=8080
      - LIGHTNING_TERMINAL_URL=http://lightning-terminal_web_1:3004
      - ELECTRS_URL=http://electrs_web_1:3002
      - BITCOIN_RPC_URL=http://bitcoin_bitcoind_1:8332
      
      # Credentials locaux
      - LND_MACAROON_PATH=/lnd/data/chain/bitcoin/mainnet/admin.macaroon
      - LND_TLS_CERT_PATH=/lnd/tls.cert
      - BITCOIN_RPC_USER=${BITCOIN_RPC_USER}
      - BITCOIN_RPC_PASS=${BITCOIN_RPC_PASS}
    volumes:
      # Accès aux données locales Umbrel
      - ${APP_LIGHTNING_NODE_DATA_DIR}:/lnd:ro
      - ${APP_BITCOIN_DATA_DIR}:/bitcoin:ro
      - ./data:/app/data
    networks:
      default:
        ipv4_address: $APP_DAZNO_IP
    depends_on:
      - lightning-terminal_web_1
      - electrs_web_1